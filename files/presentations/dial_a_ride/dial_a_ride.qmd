---
title: "An Optimal Algorithm for the Stacker Crane Problem on Fixed Topologies"
author: "Yike Chen, Ke Shi, **Chao Xu**"
format: 
  revealjs:
    incremental: false
    css: custom.css
    html-math-method: mathjax
callout-icon: false
bibliography: dial-a-ride.bib
---

## Stacker Crane on a graph

$\newcommand{\R}{\mathbb{R}}$ $\newcommand{\Z}{\mathbb{Z}}$ $\newcommand{\N}{\mathbb{N}}$

For a graph $G=(V,E)$ with cost on the edges. A single vehicle with capacity 1 is at position $s_0\in V$.

-   There are $p$ requests of the form $(s_i,t_i) \in R \subseteq V\times V$.
-   Complete a request: vehicle pick up item $i$ from $s_i$, and move it to $t_i$ without dropping it off anywhere on the way.
-   Goal: Find a tour that start and end on $s_0$, completes all requests and minimizes the total cost.


<!--
## Alternative view

-   Permutation $\pi:[n]\to [n]$, such that $\pi(i)$ is the $i$th completed request.
-   The cost of a permutation $c(\pi)$ is $\sum_{i=0}^n d(s_{\pi(i)},t_{\pi(i)}) + d(t_{\pi(i)},s_{\pi(i+1 \pmod {n+1})})$.
-   Find a permutation of minimum cost.
-->

## Stacker Crane on a path

![](line1.png){fig-align="center"}




## Stacker Crane on a path {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=350 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=550 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck.svg){.absolute top=250 left=0 width="100" height="60" data-id="truck"}

## Stacker Crane on a path {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=350 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=550 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck.svg){.absolute top=250 left=350 width="100" height="60" data-id="truck"}

::: {.absolute data-id="1" top=350 left=50}
[]{.absolute style="height: 3px;background: black;" width="350"} []{.absolute .arrow .arrowright top=9 left=342}
:::

## Stacker Crane on a path {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=550 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck.svg){.absolute top=250 left=800 width="100" height="60" data-id="truck"}

::: {.absolute data-id="1" top=350 left=50}
[]{.absolute style="height: 3px;background: black;" width="350"} []{.absolute .arrow .arrowright top=9 left=342}
:::

::: {.absolute data-id="2" top=400 left=400}
[]{.absolute style="height: 3px;background: red;" width="450"} []{.absolute .arrow .arrowright style="border-color: red;" top=9 left=440}
:::


## Stacker Crane on a path {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=550 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck_left.svg){.absolute top=250 left=550 width="100" height="60" data-id="truck"}

::: {.absolute data-id="1" top=350 left=50}
[]{.absolute style="height: 3px;background: black;" width="350"} []{.absolute .arrow .arrowright top=9 left=342}
:::

::: {.absolute data-id="2" top=400 left=400}
[]{.absolute style="height: 3px;background: red;" width="450"} []{.absolute .arrow .arrowright style="border-color: red;" top=9 left=440}
:::

::: {.absolute data-id="3" top=450 left=600}
[]{.absolute style="height: 3px;background: black;" width="250"} []{.absolute .arrow .arrowleft top=9 left=0}
:::



## Stacker Crane on a path {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck_left.svg){.absolute top=250 left=200 width="100" height="60" data-id="truck"}

::: {.absolute data-id="1" top=350 left=50}
[]{.absolute style="height: 3px;background: black;" width="350"} []{.absolute .arrow .arrowright top=9 left=342}
:::

::: {.absolute data-id="2" top=400 left=400}
[]{.absolute style="height: 3px;background: red;" width="450"} []{.absolute .arrow .arrowright style="border-color: red;" top=9 left=440}
:::

::: {.absolute data-id="3" top=450 left=600}
[]{.absolute style="height: 3px;background: black;" width="250"} []{.absolute .arrow .arrowleft top=9 left=0}
:::

::: {.absolute data-id="4" top=500 left=250}
[]{.absolute style="height: 3px;background: blue;" width="350"} []{.absolute .arrow .arrowleft style="border-color: blue;" top=9 left=0}
:::

## Stacker Crane on a path {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck_left.svg){.absolute top=250 left=0 width="100" height="60" data-id="truck"}

::: {.absolute data-id="1" top=350 left=50}
[]{.absolute style="height: 3px;background: black;" width="350"} []{.absolute .arrow .arrowright top=9 left=342}
:::

::: {.absolute data-id="2" top=400 left=400}
[]{.absolute style="height: 3px;background: red;" width="450"} []{.absolute .arrow .arrowright style="border-color: red;" top=9 left=440}
:::

::: {.absolute data-id="3" top=450 left=600}
[]{.absolute style="height: 3px;background: black;" width="250"} []{.absolute .arrow .arrowleft top=9 left=0}
:::

::: {.absolute data-id="4" top=500 left=250}
[]{.absolute style="height: 3px;background: blue;" width="350"} []{.absolute .arrow .arrowleft style="border-color: blue;" top=9 left=0}
:::

::: {.absolute data-id="5" top=550 left=50}
[]{.absolute style="height: 3px;background: black;" width="200"} []{.absolute .arrow .arrowleft top=9 left=0}
:::


## Stacker Crane on a path (Not as good) {auto-animate=true}
:::{.absolute top=150 left=40 data-id="s_0"}
$s_0$
:::
:::{.absolute top=150 left=585 data-id="s_1"}
$\color{blue}{s_1}$
:::
:::{.absolute top=150 left=235 data-id="t_1"}
$\color{blue}{t_1}$
:::
:::{.absolute top=150 left=382 data-id="s_2"}
$\color{red}{s_2}$
:::
:::{.absolute top=150 left=835 data-id="t_2"}
$\color{red}{t_2}$
:::

![](house.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-house"}
![](house.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-house"}
![](tv.svg){.absolute top=200 left=800 width="100" height="60" .filter_red data-id="red-item"}
![](box.svg){.absolute top=200 left=200 width="100" height="60" .filter_blue data-id="blue-item"}

![](truck_left.svg){.absolute top=250 left=0 width="100" height="60" data-id="truck"}

::: {.absolute data-id="1" top=350 left=50}
[]{.absolute style="height: 3px;background: black;" width="550"} []{.absolute .arrow .arrowright top=9 left=542}
:::

::: {.absolute data-id="2" top=400 left=250}
[]{.absolute style="height: 3px;background: blue;" width="350"} []{.absolute .arrow .arrowleft style="border-color: blue;" top=9 left=0}
:::

::: {.absolute data-id="3" top=450 left=250}
[]{.absolute style="height: 3px;background: black;" width="150"} []{.absolute .arrow .arrowright style="border-color: black;" top=9 left=142}
:::

::: {.absolute data-id="4" top=500 left=400}
[]{.absolute style="height: 3px;background: red;" width="450"} []{.absolute .arrow .arrowright style="border-color: red;" top=9 left=442}
:::

::: {.absolute data-id="5" top=550 left=50}
[]{.absolute style="height: 3px;background: black;" width="800"} []{.absolute .arrow .arrowleft style="border-color: black;" top=9 left=0}
:::

## Mixed Graph Formulation

::: {style="background: #fff1e8; padding:10px; margin:10px"}
Input: A base graph $B=(V,E)$, requests $R\subseteq V\times V$, cost $c:E\to \R^+$. Let $G=(V,E\cup R)$ be a mixed graph.
:::

::: {style="background: #fff1e8; padding:10px; margin:10px"}
Output: A min-cost tour of $G$ where each edge in $R$ is used exactly once.
:::

$m=|E|$, $n=|V|$, $p=|R|$

![](line2.png){fig-align="center"}

## Stacker Crane Extensions
Generalizations are called dial-a-ride problems.

-   Online [@LOISZ17; @Baligacs22]
-   Multiple Vehicles [@Desrosiers88]
-   Capacities [@CharikarR98]
-   Time windows [@DELEPLANQUE20131256]
-   Preemptive [@10.1007/11830924_20]
-   Approximation algorithms. [@FredericksonHK78; @CharikarR98; @10.1007/978-3-030-92681-6_32; @10.1007/978-3-319-71150-8_8; @yu_approximation_2023]
-   ...

## Known results

For base graphs:

::: incremental
-   Path $-$: [$O(MST(m)+p)$ time. [@AtallahK88]]{.fragment} [$\Omega(MST(m))$ time lower bound. [@Frederickson93]]{.fragment}
-   Cycle $\bigcirc$: [$O(MST(m)+p)$ time. [@Frederickson93]]{.fragment}
-   Trees: [**NP-hard**! [@FredericksonG93]]{.fragment}
-   $\boxminus$ shape: [Unknown]{.fragment}
-   $\top$ shape: [Unknown]{.fragment}
:::

## Motivation: Topology of Warehouses


![](warehouse.png){fig-align="center"}

Image courtesy [@RoodbergenK01]

<!--
## Fixed topology

A class of graphs $\mathcal{C}$ have a fixed topology, if there exists a graph $G$ such that every graph $H\in\mathcal{C}$ can be obtained through applying subdivisions of $G$.

![](subdivision1.png){fig-align="center"} ![](subdivision2.png){fig-align="center"}
-->

## Our result

::: {style="background: #fff1e8; padding:10px; margin:10px"}
Stacker Crane Problem for a fixed topology can be solved in $O(MST(m)+p)$ time.
:::

::: {.fragment style="background: #fff1e8; padding:10px; margin:10px"}
Stacker Crane Problem is FPT parametrized by cycle rank and branch number of the base graph.
:::

```{=html}
<!--
::: {style="background: #fff1e8; padding:10px;"}
Assuming the space of solutions for a certain problem is small, then stacker crane problem can be solved in $O(f(k,p)n^c)$ time.
:::
-->
```

## In This talk

-   Review the algorithm for paths and cycles
-   Show the correct generalization to general graphs

# Solve SCP on paths and cycles

Algorithms of [@AtallahK88; @Frederickson93].

## Tours and flows

Using the original formulation (no mixed graph).

 - Every solution (tour) maps to a circulation: the difference of the tour edge going forward and backwards is the flow on the edge.

## Paths

Tour traverse through a edge forward and backward the same number of times. Flow is $0$ on all edges (flow condition).

![](line4.png){fig-align="center"}

## 

The tour must traverse through $s_i$ to $t_i$.

![](line5.png){fig-align="center"}

## 

Add paths to fix the flow condition.

![](line6.png){fig-align="center"}

## 

Add opposing edges to make sure the tour is connected.

![](line7.png){fig-align="center"}

## 

Remove some vertices not incident to any edge already in the tour.

![](line9.png){fig-align="center"}

Reduced to minimum spanning tree.

## 

Obtain a complete solution by construct a tour through the chosen edges.

![](line8.png){fig-align="center"}

## SCP on a cycle

flow = 0?

![](cycle1.png){fig-align="center"}

## Winding Number

- The flow is equal on each edge! (the new flow condition)
- The *winding number*.

![](cycle2.png){fig-align="center"}

## Solution with winding number = 1

First, add the request paths.

![](cycle3.png){fig-align="center"}

## Solution with winding number = 1

Add edges to make sure each edge forward - backword = 1

![](cycle4.png){fig-align="center"}

## Solution with winding number = 1

Run minimum Steiner tree to get the set opposing edges to connect the tour.

![](cycle4.png){fig-align="center"}

## A complete solution for cycles

::: incremental
-   Guess all possible winding numbers.
-   The guess is in between $[-p,p]$.
-   For each guess $w$, compute a optimum solution with winding number $w$.
-   $O(p(MST(m)+p))$ running time.
:::

## Proximity Result

-   Find a min-cost circulation $f$ that satisfies the flow condition.
-   Assume the optimum tour maps to circulation $g$.
-   $\|f-g\|_\infty \leq 1$ [@Frederickson93]
-   $O(MST(m)+p)$ running time.

# SCP on general graphs

## Min-cost tour

::: incremental
-  Think in mixed graph formulation.
-  A valid circulation $f$, is a circulation with flow value $f(e)=1$ on each edge $e\in R$. All circulations are valid circulations from this point on.
- Each tour maps to a circulation. $[f]:=$ tours that maps to $f$.
- $[f]$ is called a *homology class*.
- $r:=m-n+1$ is the *cycle rank* of the base graph $B$.
- Vertices with degree $\geq 3$ are branch vertices.
- $k$ is the number of branch vertices in $B$.
:::

<!--
## 
![](whoepackage.png){fig-align="center"}
-->

## Interpertation of the algorithm



::: incremental
1.  Find a min-cost circulation $f$. 
2.  Find all circulations $g$ such that $\|f-g\|_\infty\leq r$.
3.  Find a min-cost tour in each $[g]$ and returns the minimum.
:::

. . .

::: {.callout-note .epic-callout-body}
# Proximity Theorem

Let $f$ be the min-cost circulation, the min-cost tour is in $[g]$ for some circulation $g$ such that $\|f-g\|_\infty\leq r$.
:::

<!--
## 



Proof sketch

   -  A circulation is *elementary*, if no cycle is traversed twice.
   -  $h$ is elementary, then $\|h\|_\infty \leq r$.
   -  $f-g$ is an elementary circulation in $B$: no negative cycles + remove cycle does not change connectvity.


## Proximity Theorem

::: {.callout-note .epic-callout-body}
# Theorem

Let $f$ be an elementary circulation, then $\|f\|_\infty\leq r$.
:::

![](bad_example2.png){fig-align="center"}

## Proximity Theorem (Tight Example)

![](bad_example.png){fig-align="center"}

Let $f=\sum_{i=1}^r C_i$, where $C_i$ is the fundamental cycle formed by $e_i$. $\|f\|_\infty \geq f(e_0) = r$.
-->

## Min-cost circulation

-   Reduces to min-cost flow on tree with $r$ more edges.
-   Reduces to a special kind of linear program.
-   The minimizer can be found in $2^{O(2^r)} m = O(m)$ time [@zemel_on_1984].

<!--
-   Let $e_1,\ldots,e_r$ be the edges outside some spanning tree $T$ of $B$.
-   $C_a$ is the fundamental cycle of $a$.

## Min-cost circulation

-   $b_e = \sum_{e \in C_a} C_a(e)$, for all $a \in R$.
-   $A_{e, i} = C_{e_i}(e)$, for all $e \in E$, $1 \leq i \leq r$. \begin{equation*}
      \begin{array}{ll@{}ll}
      \text{min}_{\lambda \in \mathbb{R}^{E \setminus T}, x \in \mathbb{R}^{T}} & \displaystyle\sum\limits_{e} x_e & \\
      \text{subject to} & x_e \geq c(e) \left( A_e \cdot \lambda + b_e \right) & \quad \forall e \in E \\
     & x_e \geq -c(e) \left( A_e \cdot \lambda + b_e \right) & \quad \forall e \in E \\
      \end{array}
    \end{equation*} $\lambda_e$ is the flow at edge $e$ in the optimum solution. There is a minimizer where $\lambda$ is integral. The minimizer can be found in $2^{O(2^r)} m = O(m)$ time [@zemel_on_1984].
-->
## Enumerate circulations

::: {.callout-note .epic-callout-body}
# Theorem

There are $O((2d+1)^r)$ circulations $g$ such that $\|f-g\|_\infty \leq d$, and can be enumerated in $O((2d+1)^rm)$ time.
:::

<!-- Proof.(sketch) Every elementary circulation can be written as $\sum_{i=1}^r \lambda_i C_i$ where $C_1,\ldots,C_r$ is a fixed fundamental cycle basis, and $\lambda\in \{-r,-r+1,\ldots,r\}^r$.-->

## Minimum Steiner Tree Problem


::: {.callout-note .epic-callout-body}
# Minimum Steiner Tree

Given a weighted graph $G=(V,E)$ and a set of terminal vertices $T\subseteq V$. Find a minimum weight tree that connects all vertices in $T$.
:::

 - NP-hard in general
 - $O(2^k MST(m))$ time if the input has at most $k$ Steiner branch vertices.

## Min-cost tour in $[g]$

 - $B'$ obtained from $G$ by contract all support edges in $g$.
 - $T$ be all vertices in $B'$ obtained from contraction.
 - min-cost tour in $[g]$ $\Leftrightarrow$ minimum Steiner tree in $B'$ with terminals $T$. 
 - $B'$ can have *MANY* branch vertices, but at most $k$ *Steiner* branch vertices.
 - Finding min-cost tour in $[g]$ takes $O(2^k MST(m))$ time.

## Results

::: {style="background: #fff1e8; padding:10px; margin:10px"}
For a base graph with at most $k$ branch vertices and cycle rank $r$, the running time of the SCP algorithm is $2^{O(2^r)}m + O((2r+1)^{r} 2^k (MST(m) + p))$.
:::

::: {style="background: #fff1e8; padding:10px; margin:10px"}
SCP problem for fixed topologies can be solved in $O(MST(m) + p)$ time.
:::

## Open problem

-   Min-cost flow on a tree with $r$ additional edges: Better than $2^{O(2^r)}m$ time?
-   Proximity result: smaller search space than $(2r+1)^r$? 

## Open problem

FPT algorithm parametrized by number of branch vertices?

. . .

Arbitrary cycle rank, exactly $1$ branch vertex

![](flower.png){fig-align="center"}

## References